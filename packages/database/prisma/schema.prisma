generator client {
    provider = "prisma-client-js"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model SignUp {
    attempts             Int      @default(0)
    emailAddress         String
    passwordHash         String
    token                String   @unique
    verificationCodeHash String
    createdAt            DateTime @default(now())
    expiresAt            DateTime

    @@id([token])
}

model User {
    id              String   @id @default(ulid())
    emailAddress    String   @unique
    passwordHash    String
    verified        Boolean  @default(false)
    passwordEnabled Boolean
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt

    sessions             Session[]
    workspaceMemberships WorkspaceMembership[]
    workspaceInvitations WorkspaceInvitation[]
    tasks                Task[]
    notifications        Notification[]
}

model Session {
    id        String   @id @default(ulid())
    userAgent String   @default("unknown")
    ipAddress String   @default("unknown")
    userId    String
    expiresAt DateTime
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Workspace {
    id   String @id @default(ulid())
    name String

    memberships WorkspaceMembership[]
    invitations WorkspaceInvitation[]
    boards      Board[]
    activities  WorkspaceActivity[]
}

model WorkspaceActivity {
    id          String   @id @default(ulid())
    workspaceId String
    message     String
    createdAt   DateTime @default(now())

    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
}

enum WorkspaceMemberRole {
    ADMIN
    MEMBER
}

model WorkspaceMembership {
    userId      String
    workspaceId String
    role        WorkspaceMemberRole
    permissions String[]
    createdAt   DateTime            @default(now())
    updatedAt   DateTime            @updatedAt

    user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    @@id([userId, workspaceId])
}

model WorkspaceInvitation {
    userId      String
    workspaceId String
    role        WorkspaceMemberRole
    createdAt   DateTime            @default(now())
    updatedAt   DateTime            @updatedAt

    user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    @@id([userId, workspaceId])
}

model Board {
    id          String   @id @default(ulid())
    workspaceId String
    title       String
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    lists List[]

    workspace Workspace @relation(fields: [workspaceId], references: [id])
}

model List {
    id        String   @id @default(ulid())
    boardId   String
    title     String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    tasks Task[]

    board Board @relation(fields: [boardId], references: [id])
}

model Task {
    id          String   @id @default(ulid())
    listId      String
    assigneeId  String
    title       String
    description String?
    dueDate     DateTime
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    list     List @relation(fields: [listId], references: [id])
    assignee User @relation(fields: [assigneeId], references: [id], onDelete: Cascade)
}

model Notification {
    id        String   @id @default(ulid())
    userId    String
    message   String
    read      Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
